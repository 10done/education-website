{% extends "base.html" %}

{% load static %}

{% block title %}
  {{ topic.title }} - Forum
{% endblock title %}
{% block content %}
  <main class="flex-1 w-full max-w-[90rem] mx-auto mt-6 px-4 md:px-6">
    <!-- Breadcrumb -->
    <nav class="mb-6 flex items-center space-x-2 text-sm">
      <a href="{% url 'forum_categories' %}"
         class="text-gray-600 dark:text-gray-400 hover:text-teal-600 dark:hover:text-teal-400">Forum</a>
      <span class="text-gray-400">/</span>
      <a href="{% url 'forum_category' category.slug %}"
         class="text-gray-600 dark:text-gray-400 hover:text-teal-600 dark:hover:text-teal-400">{{ category.name }}</a>
      <span class="text-gray-400">/</span>
      <span class="text-gray-900 dark:text-gray-100">{{ topic.title }}</span>
    </nav>
    <!-- Topic -->
    <div class="border border-gray-200 dark:border-gray-700 rounded-lg mb-6">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h1 class="text-2xl font-bold">{{ topic.title }}</h1>
          {% if topic.is_pinned %}
            <span class="bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-medium">
              <i class="fas fa-thumbtack mr-1"></i>
              Pinned
            </span>
          {% endif %}
        </div>
        <div class="flex items-center mb-4">
          <img src="{% static 'web/images/default-avatar.png' %}"
               alt="Avatar"
               width="40"
               height="40"
               class="w-10 h-10 rounded-full mr-3" />
          <div class="text-sm text-gray-600 dark:text-gray-400">
            <div class="font-medium">{{ topic.author.get_full_name|default:topic.author.username }}</div>
            <div>Posted {{ topic.created_at|timesince }} ago</div>
          </div>
        </div>
        <div class="prose dark:prose-invert max-w-none mb-4">{{ topic.content|linebreaks }}</div>
        <div class="text-sm text-gray-500 dark:text-gray-400">
          <i class="fas fa-eye mr-1"></i> {{ topic.views }} views
        </div>
      </div>
    </div>
    <!-- Replies -->
    <h2 class="text-xl font-bold mb-4">Replies</h2>
    {% for reply in replies %}
      <div class="border border-gray-200 dark:border-gray-700 rounded-lg mb-4">
        <div class="p-6">
          <div class="flex items-start">
            <img src="{% static 'web/images/default-avatar.png' %}"
                 alt="Avatar"
                 width="40"
                 height="40"
                 class="w-10 h-10 rounded-full mr-4" />
            <div class="flex-1">
              <div class="flex justify-between items-center mb-2">
                <div class="flex items-center space-x-2">
                  <span class="font-medium">{{ reply.author.get_full_name|default:reply.author.username }}</span>
                  <span class="text-sm text-gray-500 dark:text-gray-400">{{ reply.created_at|timesince }} ago</span>
                </div>
                {% if reply.is_solution %}
                  <span class="bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium">
                    <i class="fas fa-check mr-1"></i>
                    Solution
                  </span>
                {% endif %}
              </div>
              <div class="prose dark:prose-invert max-w-none">{{ reply.content|linebreaks }}</div>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-200 p-4 rounded-lg">
        No replies yet. Be the first to reply!
      </div>
    {% endfor %}
    <!-- Reply Form -->
    {% if not topic.is_locked %}
      <div class="border border-gray-200 dark:border-gray-700 rounded-lg">
        <div class="p-6">
          <h3 class="text-lg font-bold mb-4">Post a Reply</h3>
          <form method="post">
            {% csrf_token %}
            <div class="mb-4">
              <label for="content" class="block text-sm font-medium mb-2">Your Reply</label>
              <textarea name="content"
                        id="content"
                        rows="4"
                        class="w-full rounded-lg border border-gray-300 dark:border-gray-600 p-3 focus:outline-none focus:ring-2 focus:ring-teal-300 dark:focus:ring-teal-700 bg-white dark:bg-gray-800"
                        required></textarea>
            </div>
            <button type="submit"
                    class="bg-orange-500 hover:bg-orange-600 text-white font-semibold px-4 py-2 rounded-lg flex items-center">
              <i class="fa-solid fa-paper-plane mr-2"></i>
              Post Reply
            </button>
          </form>
        </div>
      </div>
    {% else %}
      <div class="bg-yellow-50 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-200 p-4 rounded-lg">
        <i class="fas fa-lock mr-2"></i>
        This topic is locked. New replies cannot be posted.
      </div>
    {% endif %}
  </main>
{% endblock content %}
