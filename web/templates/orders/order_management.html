{% extends "base.html" %}

{% block title %}
  Order Management
{% endblock title %}
{% block content %}
  <div class="container mx-auto px-4 py-8">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-2xl font-bold mb-4">Order Management</h1>
      <!-- Filter by Order Status -->
      <div class="mb-6">
        <form method="get" class="flex space-x-4">
          <select name="status" class="form-select">
            <option value="">All Statuses</option>
            {% for value, label in status_choices %}
              <option value="{{ value }}"
                      {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <button type="submit" class="btn btn-primary">Filter</button>
        </form>
      </div>
      <!-- Orders Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white dark:bg-gray-800">
          <thead>
            <tr>
              <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Order ID</th>
              <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Buyer</th>
              <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Total Price</th>
              <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Status</th>
              <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Payment Confirmation</th>
              <th class="px-6 py-3 border-b border-gray-200 dark:border-gray-700">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
              <tr>
                <td class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">{{ order.id }}</td>
                <td class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                  {{ order.user.get_full_name|default:order.user.username }}
                </td>
                <td class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">${{ order.total_price }}</td>
                <td class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">{{ order.get_status_display }}</td>
                <td class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">{{ order.payment_intent_id }}</td>
                <td class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                  <a href="{% url 'order_detail' order.id %}"
                     class="text-blue-600 hover:text-blue-800">View</a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6"
                    class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">No orders found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      <div class="mt-6">
        {% if is_paginated %}
          <nav class="pagination">
            <span class="page-links">
              {% if page_obj.has_previous %}
                <a href="?{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
              {% endif %}
              <span class="page-current">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
              {% if page_obj.has_next %}
                <a href="?{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
              {% endif %}
            </span>
          </nav>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock content %}
